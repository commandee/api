generator kysely {
  provider     = "prisma-kysely"
  output       = "../src/database/generated/schema"
  enumFileName = "enums.ts"
  fileName     = "schema.d.ts"
}

datasource db {
  provider     = "mysql"
  url          = env("PRISMA_URL")
  relationMode = "prisma"
}

model Commanda {
  id           String     @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  costumer     String     @db.VarChar(255)
  table        Int?
  publicId     String     @unique @map("public_id") @db.VarChar(16)
  orders       Order[]
  restaurantId String     @map("restaurant_id") @db.VarChar(36)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@map("commanda")
  @@index([restaurantId])
}

model Employee {
  id       String        @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  username String        @unique @db.VarChar(255)
  email    String        @unique @db.VarChar(255)
  password String        @db.VarChar(255)
  publicId String        @unique @map("public_id") @db.VarChar(16)
  worksAt  Employment[]

  @@map("employee")
  @@index([email])
  @@index([username])
}

model Employment {
  employeeId   String     @map("employee_id") @db.VarChar(36)
  restaurantId String     @map("restaurant_id") @db.VarChar(36)
  role         Role       @default(employee)
  employee     Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@id([employeeId, restaurantId])
  @@index([restaurantId])
  @@index([employeeId])
  @@index([role])
  @@map("employment")
}

enum Role {
  admin
  employee

  @@map("role")
}

model Item {
  id           String     @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name         String     @db.VarChar(255)
  price        Int
  description  String?    @db.VarChar(255)
  restaurantId String     @map("restaurant_id") @db.VarChar(36)
  publicId     String     @unique @map("public_id") @db.VarChar(16)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  orders       Order[]

  @@index([name])
  @@index([restaurantId])
  @@map("item")
}

model Order {
  id           String     @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  commandaId   String     @map("commanda_id") @db.VarChar(36)
  itemId       String     @map("item_id") @db.VarChar(36)
  quantity     Int        @default(1)
  priority     Priority   @default(low)
  status       Status     @default(pending)
  notes        String?    @db.VarChar(512)
  publicId     String     @unique @map("public_id") @db.VarChar(16)
  commanda     Commanda   @relation(fields: [commandaId], references: [id], onDelete: Cascade)
  item         Item       @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([commandaId])
  @@map("order")
}

model Restaurant {
  id           String        @id @default(dbgenerated("(uuid())")) @db.VarChar(36)
  name         String        @unique @db.VarChar(255)
  address      String        @db.VarChar(255)
  publicId     String        @unique @map("public_id") @db.VarChar(16)
  employements Employment[]
  commandas    Commanda[]
  items        Item[]

  @@map("restaurant")
}

enum Priority {
  low
  medium
  high

  @@map("priority")
}

enum Status {
  pending
  inProgress @map("in_progress")
  done

  @@map("status")
}
